machine:
  node:
    version: 6.9.1

dependencies:
  cache_directories:
    - node_modules

test:
  override:
    - npm run build
    - npm run test

  post:
    - cp ./config ./build -r
    - cp ./node_modules ./build -r
    - cp ./package.json ./build
    - cp ./newrelic.js ./build
    - cd ./build && tar --exclude='*.map' --exclude='test' --exclude='.git' -zcvf $CIRCLE_ARTIFACTS/build.tar.gz .
    - cat coverage/lcov.info | node_modules/coveralls/bin/coveralls.js
